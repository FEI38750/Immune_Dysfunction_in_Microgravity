# Heatmap and correlation test of 106 core genes after Q treatment
gene_name<-c("THBS1","FTH1","S100A8","MS4A7","CYP27A1","CXCL8","SLC7A11","TALDO1","S100A12","KYNU","HSP90AA1","HSPB1","IL1B","HNRNPC","GAPT","PLIN2","PGD","TUBA1C","HSPA1A","TMBIM6","PTGES3","BIRC3","TMEM138","HSPH1","ITGB2","TXNRD1","LUCAT1","CYB561A3","IFNGR1","AHRR","ATG7","PEA15","FKBP4","PTPN12","RHOU","RPL22","LCP1","G3BP1","CD27","TAP1","IQGAP2","CIB1","LCP2","SLC23A2","ODF3B","GPNMB","TMC6","SIPA1","HLA-DMB","RASAL3","SEPTIN1","ZAP70","CD83","HLA-DQB1","APOL6","PCED1B-AS1","NLRC5","DEF6","RNF166","SEPTIN6","MS4A6A","PCED1B","ADA2","FUS","SH2D2A","FABP5","LAP3","JAK2","SUSD3","MEF2C","ZFP36L2","CD7","GSTK1","PSMB8","CCL22","TRABD","IL2RB","LSP1","NEAT1","TBC1D10C","PSMB10","HLA-F","VAMP5","APOBEC3G","PSME1","ARHGEF1","CLIC3","FXYD5","SRSF5","FCGR3A","GBP4","ACTG1","CORO1A","PLAAT4","CXCR3","RNASE1","IRF1","FGL2","GBP2","PSMB9","HLA-E","GBP5","PSME2","GBP1","RBM3","STAT1")
Log2FC_SC<-c("1.245750135","0.991267993","0.520580299","0.493718488","0.454426862","0.449788473","0.406667176","0.3563693","0.328040922","0.275923861","0.253098265","0.24192268","0.241156603","0.238071602","0.235409247","0.213118249","0.210436064","0.181102944","0.178772777","0.176929588","0.176762841","0.164656408","0.158329345","0.151126492","0.149729392","0.149557854","0.141770268","0.141462368","0.137328468","0.13199954","0.131893014","0.130719549","0.118125215","0.110270736","0.106955199","0.101743635","0.101197204","0.101094282","-0.100127954","-0.100774406","-0.102629179","-0.103116687","-0.103381508","-0.103731629","-0.103953231","-0.10414942","-0.106014429","-0.107317022","-0.107380592","-0.108486245","-0.109213424","-0.110623886","-0.111268595","-0.111312883","-0.111351962","-0.112615961","-0.113156869","-0.116523269","-0.117368184","-0.117377538","-0.117433968","-0.124148229","-0.128279316","-0.128324639","-0.128572333","-0.130797276","-0.131245463","-0.132369601","-0.133309425","-0.135665656","-0.137451706","-0.137727696","-0.138989365","-0.139033358","-0.144024982","-0.144957809","-0.14584337","-0.147185903","-0.151264229","-0.154733176","-0.158399595","-0.161038327","-0.163706843","-0.165663002","-0.166865731","-0.168491611","-0.170859504","-0.170885199","-0.17121185","-0.17645034","-0.19858763","-0.200784485","-0.202634161","-0.203289312","-0.203436445","-0.206389585","-0.206970886","-0.21085244","-0.218920524","-0.224251689","-0.227799798","-0.247976844","-0.252967295","-0.262456935","-0.407978276","-0.575206175")
Log2FC_bulk<-c("1.807983346","0.510540835","0.42420456","0.710716919","1.086405615","1.459663911","1.674313532","0.571503917","1.161294124","0.621315362","0.241779329","0.406408834","1.552466675","0.266910455","0.89005661","0.54078451","0.579585453","0.365050179","0.379504686","0.234646084","0.247569467","0.277741592","0.74209126","0.368242737","0.260256376","0.627464262","1.006041147","0.651616057","0.641531306","1.224535451","0.430579664","0.274146694","0.348837995","0.325000646","0.804663992","0.186460873","0.289423535","0.247055416","-0.218039027","-0.507580195","-0.373145017","-0.240171669","-0.370795241","-0.238744256","-0.999829837","-1.745088918","-0.322199393","-0.271090393","-0.68150993","-0.36074973","-0.265755727","-0.350769428","-0.939634158","-0.386178591","-0.599959602","-0.266767592","-0.536914733","-0.342317277","-0.269966344","-0.296635886","-2.178028529","-0.442329109","-0.44714767","-0.249758021","-0.56017929","-0.934813422","-0.751664397","-0.3073101","-0.255562855","-0.464776829","-0.242583021","-0.430594332","-0.357873123","-0.292072751","-1.194830526","-0.398292397","-0.347276594","-0.480250298","-0.446024175","-0.295168038","-0.416724714","-0.427017948","-0.643096683","-0.343578337","-0.295843229","-0.335182695","-0.354499439","-0.273556271","-0.330445028","-0.701989466","-0.720795772","-0.238476197","-0.298872727","-0.271667234","-0.452583222","-1.541555994","-0.645995274","-0.686196011","-0.653581969","-0.47541112","-0.203208535","-0.891054489","-0.519053999","-1.433737387","-0.850079619","-0.80791485")
log2FC_Q<-c("-3.815003445","-1.463334399","-2.868628978","-5.108511548","-3.321395348","-1.073397426","-2.566116008","-1.568440895","-3.840390543","-2.13859154","-0.396429315","-1.704752211","-4.08736902","0.149901709","-5.064447832","-1.003157252","-1.802078325","-2.138203196","-1.954564133","-0.444807909","-0.324330768","0.307548315","-1.980528589","-0.012258556","-2.30114772","-0.313602094","-1.455928357","-1.579473769","-1.738836338","-2.530268792","-2.330126699","-2.274244081","-0.32985039","-1.219627649","-2.746118028","0.728207854","-0.676443605","-0.088063232","0.738604736","0.228837694","-0.560218287","-0.221748616","0.161167078","-1.152935435","-3.211274426","-4.088907825","0.565968064","0.26273346","-1.976403605","0.749471262","0.444874451","0.852655979","1.071950357","-1.319138933","0.263792197","0.34315933","0.08203057","0.66507194","0.50527398","0.577814906","-4.541713923","0.474630017","-2.163954718","0.382329592","1.508216757","-1.874484285","-1.870301076","-1.079895497","0.389335876","-0.454152765","0.337317916","1.938136218","-0.622816107","-0.074766182","-0.634732397","0.22325156","0.697803456","-0.27408787","0.719775721","0.821062263","-0.110133171","0.100449892","-0.231544337","0.363355027","-0.457948766","0.376479902","0.532801045","0.527839452","0.393770177","-1.712250176","0.653100929","-0.248194236","0.520229974","0.19630287","0.757664913","-0.721756145","0.19273991","-3.825257147","0.397918253","-0.04752348","0.572932583","0.031362035","-0.897753442","-0.008405227","-0.650609791","-1.972125474")

df<-data.frame(gene_name,uGvs1G=Log2FC_bulk,Q_treatment=log2FC_Q)
df<-tibble::column_to_rownames(df,"gene_name")
df<-dplyr::mutate_all(df, function(x) as.numeric(as.character(x))) # convert entire datafrome to numberic

paletteLength <- nrow(df) # 106 overlapped core genes
myColor <- colorRampPalette(c("blue", "white", "red"))(paletteLength)

# use floor and ceiling to deal with even/odd length pallettelengths
myBreaks <- c(seq(-2, 0, length.out=ceiling(paletteLength/2) + 1), 
              seq(max(df)/paletteLength, max(df), length.out=floor(paletteLength/2)))
pheatmap::pheatmap(df,color=myColor, breaks=myBreaks,
                   cluster_rows = T,cluster_cols =F,fontsize_row = 6)

# correlation test
cor.test(df[,1],df[,2])
# scatter plot of correlation results
library("ggpubr")
ggscatter(df, x = "uGvs1G", y = "Q_treatment", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.coef.size=6,cor.coef.coord=c(-2.2,2),
          xlab = "uG vs 1G", ylab = "uG+Q vs 1G", title = "Quercetin treatment")
ggsave("Q_treatment_uG_coreGene.pdf",width = 5, height = 4)

