# Heatmap and correlation test of 70 core genes after Q treatment
gene_name<-c("MMP9","THBS1","SOD2","MS4A7","CYP27A1","CXCL8","SLC7A11","TALDO1","S100A12","KYNU","MPEG1","IL1B","GAPT","PLIN2","PGD","IRAK3","TMEM138","TXNRD1","LUCAT1","CYB561A3","IFNGR1","ATG7","GSN","ADAMDEC1","RHOU","RPL22","TAP1","IQGAP2","LCP2","SLC23A2","GPNMB","TMC6","HLA-DMB","ZAP70","CD83","HLA-DQB1","APOL6","NLRC5","SEPTIN6","MS4A6A","TNFSF13B","DUSP2","PCED1B","ADA2","SH2D2A","FABP5","LAP3","JAK2","ZFP36L2","GSTK1","PSMB8","TRABD","LSP1","HLA-F","VAMP5","PSME1","ARHGEF1","FCGR3A","HLA-DPB1","GBP4","ACTG1","IRF1","FGL2","GBP2","PSMB9","GBP5","PSME2","GBP1","RBM3","STAT1")
Log2FC_SC<-c("1.370507866","1.245750135","0.498756419","0.493718488","0.454426862","0.449788473","0.406667176","0.3563693","0.328040922","0.275923861","0.247664252","0.241156603","0.235409247","0.213118249","0.210436064","0.177880743","0.158329345","0.149557854","0.141770268","0.141462368","0.137328468","0.131893014","0.131815919","0.125126126","0.106955199","0.101743635","-0.100774406","-0.102629179","-0.103381508","-0.103731629","-0.10414942","-0.106014429","-0.107380592","-0.110623886","-0.111268595","-0.111312883","-0.111351962","-0.113156869","-0.117377538","-0.117433968","-0.117549837","-0.121859176","-0.124148229","-0.128279316","-0.128572333","-0.130797276","-0.131245463","-0.132369601","-0.137451706","-0.138989365","-0.139033358","-0.144957809","-0.147185903","-0.161038327","-0.163706843","-0.166865731","-0.168491611","-0.17645034","-0.184332625","-0.19858763","-0.200784485","-0.206970886","-0.21085244","-0.218920524","-0.224251689","-0.247976844","-0.252967295","-0.262456935","-0.407978276","-0.575206175")
Log2FC_bulk<-c("0.905852423","1.857054058","0.375913906","0.655034128","1.082172627","1.573223068","1.899455044","0.617170936","1.255496042","0.512482647","0.356104105","1.596913323","0.995334815","0.534838832","0.527241473","0.790231774","0.612069346","0.556555996","0.853049394","0.615401252","0.590622308","0.505221432","0.558399127","0.442398154","0.644023552","0.232900899","-0.645831765","-0.399992577","-0.389257803","-0.361580024","-1.728911684","-0.309857436","-0.620422196","-0.361480267","-0.873583258","-0.43284822","-0.755628813","-0.509566499","-0.239269847","-2.199577526","-0.503518024","-0.42593191","-0.353551105","-0.544267095","-0.500332003","-0.819257256","-1.027562029","-0.429613214","-0.250736979","-0.439376328","-0.334996025","-0.474333399","-0.337013764","-0.409548233","-1.050031279","-0.367886551","-0.33842736","-0.747002959","-0.438764976","-0.87348032","-0.269248826","-0.742602543","-0.81902626","-0.82854603","-0.58274955","-0.934183733","-0.781431917","-1.771442676","-0.367229564","-1.163396352")
log2FC_Q<-c("-8.690728265","-5.049313556","-2.033203011","-5.660075005","-3.752311727","-1.991279327","-3.255090842","-1.773957827","-4.22018832","-2.493079958","-4.893823545","-4.945623369","-5.449652028","-1.424842868","-1.995710421","-4.965951709","-1.899088694","-0.517498927","-1.952474476","-1.457813071","-1.969107057","-2.363857561","-4.157781064","-6.735138447","-2.963843272","0.636507326","0.231559828","-0.637202563","-0.046740309","-1.08830377","-4.87596692","0.613959105","-1.575054777","0.769392132","1.10100801","-0.998562775","0.187182095","-0.064511613","0.411598857","-6.050801003","-3.368620429","0.537175036","0.334041165","-2.080683227","1.596432152","-2.297735192","-2.034919673","-0.946511406","0.157493231","-0.530831247","-0.051286197","0.365249349","-0.036000868","0.143521579","-0.014548792","-0.604267253","0.329804571","-1.735466801","-1.779452838","0.533517666","-0.444013632","0.176534077","-4.245044135","0.274083295","0.049504066","-0.14877723","-0.644725315","-0.063077674","-0.453739193","-2.090470077")

df<-data.frame(gene_name,uGvs1G=Log2FC_bulk,Q_treatment=log2FC_Q)
df<-tibble::column_to_rownames(df,"gene_name")
df<-dplyr::mutate_all(df, function(x) as.numeric(as.character(x))) # convert entire datafrome to numberic

paletteLength <- nrow(df) # 70 overlapped core genes
myColor <- colorRampPalette(c("blue", "white", "red"))(paletteLength)

# use floor and ceiling to deal with even/odd length pallettelengths
myBreaks <- c(seq(-2, 0, length.out=ceiling(paletteLength/2) + 1), 
              seq(max(df)/paletteLength, max(df), length.out=floor(paletteLength/2)))
pheatmap::pheatmap(df,color=myColor, breaks=myBreaks,
                   cluster_rows = T,cluster_cols =F,fontsize_row = 6)

# correlation test
cor.test(df[,1],df[,2])
# scatter plot of correlation results
library("ggpubr")
ggscatter(df, x = "uGvs1G", y = "Q_treatment", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.coef.size=6,cor.coef.coord=c(-2.2,2),
          xlab = "uG vs 1G", ylab = "uG+Q vs 1G", title = "Quercetin treatment")
ggsave("Q_treatment_uG_coreGene.pdf",width = 5, height = 4)

